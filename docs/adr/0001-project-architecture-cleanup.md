# ADR-0001: 專案架構清理與重組

**狀態**: Partially Implemented  
**日期**: 2025-01-08  
**更新**: 2025-01-09  
**決策者**: Claude Code 分析 + 專案團隊  
**技術故事**: 專案健康狀況分析報告

## 背景與問題陳述

專案健康狀況分析發現嚴重的架構問題：
- 5 個不同位置的重複 LSTM 實現（約 1,200+ 行重複代碼）
- `sanbox/` 實驗代碼混在正式專案中
- 55+ 個空文件散布各處
- 命名不一致和結構混亂
- 測試覆蓋率 < 30%

這些問題嚴重影響：
- 程式碼維護性
- 新開發者理解成本
- 錯誤修復的完整性
- 整體開發效率

## 決策驅動因素

- **可維護性**: 重複代碼導致維護困難
- **程式碼品質**: 空文件和混亂結構影響專案形象
- **開發效率**: 新團隊成員難以快速上手
- **學術嚴謹性**: 作為研究專案需要高品質的程式碼基礎

## 考慮的選項

### 選項 1: 漸進式重構

- **優點**:
  - 風險較低
  - 不影響現有功能
  - 可以逐步改善
- **缺點**:
  - 耗時較長
  - 可能無法根本解決問題
  - 重複代碼持續存在

### 選項 2: 大規模重組

- **優點**:
  - 徹底解決架構問題
  - 建立清晰的專案結構
  - 為後續開發奠定良好基礎
- **缺點**:
  - 短期內可能影響開發進度
  - 需要大量測試確保功能完整

### 選項 3: 保持現狀

- **優點**:
  - 不需要額外工作
  - 不影響當前開發
- **缺點**:
  - 技術債務持續累積
  - 維護成本越來越高
  - 影響專案長期發展

## 決策結果

**選擇**: 選項 2 - 大規模重組

**理由**: 
1. 專案處於相對早期階段，重組成本相對較低
2. 作為學術研究專案，需要高品質的程式碼基礎
3. 清理後的架構將大幅提升後續開發效率
4. 有助於期末報告和論文撰寫時的程式碼展示

## 實施細節

### 立即行動（1-2 週）
1. **移除重複代碼**:
   - 保留 `src/social_xlstm/models/traffic_lstm.py` 作為標準實現
   - 刪除 `sanbox/train/` 中的重複 LSTM 實現
   - 整合有用功能到標準實現

2. **清理空文件**:
   ```bash
   find . -type f -empty -delete
   ```

3. **修復依賴**:
   - 更正 `setup.py` 中的套件名稱
   - 驗證所有依賴的必要性

### 短期改善（2-4 週）
1. **重組專案結構**:
   ```
   Social-xLSTM/
   ├── src/social_xlstm/      # 核心庫（保持）
   ├── examples/              # 示例代碼（新建）
   ├── scripts/              # 數據處理腳本（精簡）
   ├── experiments/          # 實驗代碼（新建）
   └── tests/               # 統一測試（重命名）
   ```

2. **提升測試覆蓋率**:
   - 目標：> 70%
   - 為每個核心模組添加單元測試
   - 實現整合測試

## 後果

### 正面後果

- **提升可維護性**: 單一 LSTM 實現，修改更容易
- **改善開發體驗**: 清晰的專案結構便於導航
- **提高程式碼品質**: 測試覆蓋率提升，bug 減少
- **學術形象**: 高品質的程式碼有助於論文發表

### 負面後果

- **短期開發延遲**: 重組期間可能影響新功能開發
- **測試工作量**: 需要大量時間編寫測試
- **學習成本**: 團隊需要適應新的專案結構

### 風險與緩解措施

- **功能遺失風險**: 重組過程中可能遺失功能 / **緩解**: 詳細記錄現有功能，逐一驗證
- **時程延誤風險**: 重組耗時超出預期 / **緩解**: 分階段執行，優先處理關鍵問題
- **引入新 bug 風險**: 大規模修改可能引入錯誤 / **緩解**: 充分測試，逐步部署

## 相關決策

- [ADR-0002: 文檔組織架構](0002-documentation-organization.md)

## 註記

此決策是基於 2025-01-08 的專案健康狀況分析結果。重組完成後應定期回顧專案架構品質，避免再次累積技術債務。