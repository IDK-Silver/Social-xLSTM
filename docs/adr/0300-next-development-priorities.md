# ADR-0300: 下一階段開發優先級規劃

**狀態**: Accepted  
**日期**: 2025-01-08  
**決策者**: 專案團隊  
**技術故事**: 基於目前專案狀況的後續發展規劃

## 背景與問題陳述

經過專案健康狀況分析和現有功能盤點，需要制定明確的開發優先級：

**現狀**:
- ✅ 數據處理管線完整（XML → JSON → HDF5）
- ✅ 座標系統完善（墨卡托投影 + CoordinateSystem）
- ✅ LSTM 基準模型實現
- ✅ 評估框架建立
- 🚧 Social-xLSTM 核心算法待實現
- ❌ 程式碼重複問題嚴重
- ❌ 專案結構混亂

**時間限制**: 學期末前需完成核心實驗和期末報告

## 決策驅動因素

- **學術截止日期**: 期末報告和論文撰寫時程
- **技術債務影響**: 程式碼重複問題影響開發效率
- **研究核心價值**: Social-xLSTM 是專案的核心創新
- **實驗驗證需求**: 需要充足時間進行模型訓練和效能比較

## 考慮的選項

### 選項 1: 先清理架構，再開發核心功能

- **優點**:
  - 提供乾淨的開發環境
  - 避免在混亂結構上開發新功能
  - 降低後續維護成本
- **缺點**:
  - 前期投入時間多
  - 可能影響核心功能開發時程

### 選項 2: 先實現核心功能，後清理架構

- **優點**:
  - 優先保證研究目標達成
  - 核心功能可以先驗證可行性
- **缺點**:
  - 在混亂環境中開發可能引入更多問題
  - 清理時可能影響核心功能

### 選項 3: 並行進行

- **優點**:
  - 時間效率高
  - 可以同時改善架構和推進研究
- **缺點**:
  - 可能造成衝突
  - 需要更好的協調

## 決策結果

**選擇**: 選項 1 - 先清理架構，再開發核心功能

**理由**:
1. **技術債務阻礙效率**: 5個重複LSTM實現和混亂結構嚴重影響開發效率
2. **避免重複工作**: 在混亂架構上開發新功能可能需要重複修改
3. **確保程式碼品質**: 學術專案需要高品質的程式碼基礎
4. **降低維護成本**: 清理後的架構將大幅提升後續開發效率

## 實施細節

### 第一週：架構清理優先
**階段性任務**:

**階段 1: 緊急架構清理 (1-3天)**
- 執行 ADR-0002 LSTM 統一方案
- 移除 `sanbox/` 重複 LSTM 代碼
- 清理空文件
- 修復 `setup.py` 套件名稱

**階段 2: 結構重組 (4-7天)**
- 重組目錄結構
- 統一測試框架
- 建立清晰的開發環境

### 第二週：核心功能開發
**基於清理後的架構**:

- 實現座標驅動社交池化層
- 設計 Hybrid xLSTM 架構
- 創建模型骨架
- 完成社交池化算法
- 實現 sLSTM 和 mLSTM
- 集成訓練流程

### 第三週：實驗驗證 + 品質提升
**並行任務**:

**Track A: 程式碼品質**
- 程式碼審查和重構
- 增加單元測試
- 文檔更新

**Track B: 模型訓練與評估**
- Social-xLSTM vs LSTM 基準比較
- 超參數調優
- 性能分析

### 第四週：論文準備 + 最終整理
- 實驗結果分析
- 期末報告撰寫
- 程式碼最終清理

## 具體優先級清單

### P0 (本週必須完成) - 架構清理優先
1. **執行 ADR-0002 LSTM 統一方案** - 3天
2. **移除重複 LSTM 代碼和空文件** - 1天
3. **重組專案結構** - 2天
4. **建立清晰的開發環境** - 1天

### P1 (下週完成) - 核心功能開發
5. **實現社交池化核心算法** - 3天
6. **創建 Social-xLSTM 模型骨架** - 2天
7. **完整 xLSTM 實現 (sLSTM + mLSTM)** - 2天

### P2 (第三週)
7. **模型訓練和基準比較** - 5天
8. **提升測試覆蓋率** - 2天

### P3 (第四週)
9. **實驗結果分析** - 3天
10. **期末報告撰寫** - 4天

## 後果

### 正面後果

- **高效利用時間**: 並行開發最大化時間效率
- **降低風險**: 分階段驗證，及早發現問題
- **品質保證**: 逐步改善程式碼品質
- **研究目標達成**: 確保核心功能按時完成

### 負面後果

- **協調複雜度**: 需要仔細管理並行任務
- **潛在衝突**: 架構變更可能影響正在開發的功能
- **壓力增加**: 並行推進增加開發壓力

### 風險與緩解措施

- **任務衝突風險**: 並行任務可能相互影響 / **緩解**: 明確分工，定期同步
- **時程延誤風險**: 任務複雜度估計不準 / **緩解**: 每週回顧調整，保持彈性
- **品質下降風險**: 趕進度可能影響品質 / **緩解**: 設定最低品質標準，不妥協核心功能

## 成功指標

### 第一週結束
- [ ] `sanbox/` 目錄清理完成
- [ ] 社交池化演算法原型實現
- [ ] Social-xLSTM 模型骨架能夠載入和初始化

### 第二週結束
- [ ] 完整的 Social-xLSTM 模型實現
- [ ] 能夠在小數據集上訓練
- [ ] 專案結構重組完成

### 第三週結束
- [ ] Social-xLSTM vs LSTM 基準比較完成
- [ ] 測試覆蓋率 > 70%
- [ ] 初步實驗結果可用

### 第四週結束
- [ ] 期末報告完成
- [ ] 程式碼品質達到發布標準
- [ ] 所有實驗結果文檔化

## 相關決策

- [ADR-0001: 專案架構清理與重組](0001-project-architecture-cleanup.md)
- [ADR-0100: Social Pooling vs Graph Networks](0100-social-pooling-vs-graph-networks.md)
- [ADR-0101: xLSTM vs Traditional LSTM](0101-xlstm-vs-traditional-lstm.md)

## 註記

此規劃基於學期末的時間限制和當前專案狀況。優先級調整為：**架構清理 > 核心功能實現 > 實驗驗證 > 程式碼品質**。

**重要決策變更**: 經過重新評估，決定優先進行架構清理，因為：
1. 現有的5個重複LSTM實現嚴重阻礙開發效率
2. 在混亂架構上開發核心功能會導致重複工作
3. 清理後的架構將大幅提升後續開發效率

每週五進行進度回顧，必要時調整優先級和資源分配。