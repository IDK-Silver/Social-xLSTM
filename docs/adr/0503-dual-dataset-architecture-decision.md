# ADR-0503: 雙資料集架構決策 - METR-LA 與台灣交通資料統一支援

## 狀態
**已批准** - 2025-01-22

## 決策者
- Technical Lead
- 指導教授意見納入
- Zen多模型分析驗證

## 決策背景

### 問題陳述
指導教授提出關鍵問題：「我這樣要怎麼去跟別人比較？」

這反映了一個核心學術挑戰：
- Social-xLSTM專案基於台灣獨有的多特徵交通資料
- 缺乏與國際標準基準（如METR-LA）的直接可比較性
- 需要在學術認可和實用創新之間找到平衡

### 驅動因素

**學術發表需求**：
- 頂級會議（NeurIPS, ICML, KDD）要求與已發表論文公平比較
- METR-LA是交通預測領域的黃金標準基準
- 無METR-LA結果的論文難以獲得國際認可

**技術創新價值**：
- 台灣資料提供5個豐富特徵 vs METR-LA的單一速度特徵
- 真實世界應用潛力高於學術基準資料
- 多特徵Social Pooling是重要的技術創新

**實用部署考量**：
- 台灣交通部實際使用的官方資料
- 完整的交通基本圖參數支援
- 政府交通管理系統直接整合可行

## 考慮的方案

### 方案A：純台灣資料策略
**描述**：專注於台灣多特徵資料，忽略國際基準

**優勢**：
- 展示完整的多特徵優勢
- 專注於實用價值和創新
- 開發複雜度最低

**劣勢**：
- 缺乏國際可比較性
- 頂級會議發表困難
- 學術影響力受限
- 評審可能質疑模型泛化能力

**風險評估**：高風險 - 學術認可度不足

### 方案B：純METR-LA策略  
**描述**：專注於METR-LA基準，放棄台灣資料

**優勢**：
- 直接與國際SOTA比較
- 頂級會議發表門檻較低
- 學術認可度高

**劣勢**：
- 失去多特徵創新價值
- 無法展示實際應用潛力
- 與專案原始目標偏離
- 技術創新點不足

**風險評估**：中風險 - 創新價值不足

### 方案C：分離架構策略
**描述**：為兩個資料集開發完全獨立的模型架構

**優勢**：
- 每個資料集都有最優化的處理
- 開發風險相對獨立
- 可以針對性優化性能

**劣勢**：
- 開發和維護成本高
- 無法展示統一架構的技術價值
- 代碼重複，技術債累積
- 缺乏跨資料集洞察

**風險評估**：中風險 - 維護複雜度高

### 方案D：統一架構策略 ⭐
**描述**：設計統一的Social-xLSTM架構，同時支援兩個資料集

**優勢**：
- 最佳的學術價值和實用價值平衡
- 展示技術架構的靈活性和通用性  
- 提供跨資料集分析的獨特洞察
- 為未來整合其他資料集奠定基礎

**劣勢**：
- 架構設計複雜度較高
- 需要仔細的特徵投影設計
- 調試和優化挑戰

**風險評估**：低風險 - 收益最大化

## 決策

**選擇方案D：統一架構策略**

### 決策依據

**技術可行性**：
- AdaptiveFeatureProjector可以優雅處理維度差異
- MultiModalGraphEncoder統一空間建模方法
- 核心Social-xLSTM算法保持完全一致

**學術價值最大化**：
- METR-LA結果確保國際認可和可比較性
- 台灣資料展示實用價值和技術創新
- 統一架構本身就是重要的技術貢獻

**實施風險可控**：
- 模組化設計降低複雜度
- 階段性開發策略控制風險
- 充分的風險緩解措施

**長期價值**：
- 為未來資料集整合建立基礎
- 推動領域向多特徵方向發展
- 建立台灣交通資料的國際認知

## 實施細節

### 核心架構設計

```python
class UnifiedSocialXLSTM(nn.Module):
    def __init__(self, dataset_configs):
        super().__init__()
        # 自適應特徵投影層
        self.feature_projector = AdaptiveFeatureProjector(dataset_configs)
        # 多模態圖編碼器
        self.graph_encoder = MultiModalGraphEncoder()
        # 統一的Social-xLSTM核心
        self.social_xlstm_core = SocialXLSTMCore(hidden_dim)
        
    def forward(self, x, adjacency, dataset_name):
        # 1. 特徵投影：不同維度 → 統一維度
        projected_features = self.feature_projector(x, dataset_name)
        # 2. 圖編碼：統一的空間關係處理
        graph_encoded = self.graph_encoder(projected_features, adjacency)
        # 3. 核心算法：完全相同的Social-xLSTM
        output = self.social_xlstm_core(graph_encoded)
        return output
```

### 資料適配策略

**METR-LA適配**：
```python
metr_la_config = {
    'input_dim': 1,           # 單一速度特徵
    'nodes': 207,             # 207個感測器
    'graph_method': 'knn',    # 基於道路網絡距離
    'features': ['speed']
}
```

**台灣資料適配**：
```python
taiwan_config = {
    'input_dim': 5,           # 5個豐富特徵
    'graph_method': 'threshold',  # 基於地理座標距離
    'features': ['avg_speed', 'total_volume', 'avg_occupancy', 
                'speed_std', 'lane_count']
}
```

### 評估框架設計

**雙重評估策略**：
1. **學術評估**：METR-LA標準指標（MAE, RMSE, MAPE）
2. **實用評估**：台灣資料實際應用指標
3. **跨資料集分析**：統一架構的有效性驗證
4. **特徵重要性**：多特徵對預測精度的貢獻分析

## 成功標準

### 學術成功標準
- **METR-LA基準**：15分鐘預測MAE ≤ 3.00
- **SOTA競爭力**：至少達到top-3模型性能
- **統計顯著性**：通過統計檢驗的性能提升

### 技術成功標準  
- **統一架構有效性**：兩個資料集都獲得良好性能
- **特徵投影效果**：ablation study證明設計合理
- **跨資料集洞察**：發現有意義的技術規律

### 實用成功標準
- **多特徵優勢**：台灣資料上顯著優於單特徵baseline
- **部署可行性**：實際計算成本和延遲在可接受範圍
- **系統可用性**：完整的雙資料集支援和文檔

## 風險與緩解措施

### 高風險：METR-LA性能不達標
**緩解措施**：
- 充分的超參數調優和架構優化
- 參考SOTA模型的最佳實踐
- 必要時調整模型複雜度

### 中風險：架構過於複雜
**緩解措施**：
- 模組化設計，清晰的接口分離
- 充分的單元測試和整合測試
- 階段性開發，逐步驗證

### 中風險：特徵投影有效性不足
**緩解措施**：
- 詳細的ablation study
- 多種投影方法的比較
- 可解釋性分析

## 實施計畫

### Phase 1：核心架構實現 (2週)
- AdaptiveFeatureProjector實現
- MultiModalGraphEncoder實現  
- 統一接口設計

### Phase 2：METR-LA基準驗證 (1週)
- METR-LA資料適配
- 標準基準測試
- 性能優化

### Phase 3：台灣資料整合 (1週)
- 台灣資料適配
- 多特徵優勢驗證
- 跨資料集測試

### Phase 4：評估和分析 (1週)
- 雙重評估框架實現
- 跨資料集分析
- 結果文檔和論文準備

## 長期影響

### 技術影響
- 建立交通預測統一架構的設計模式
- 推動多特徵交通建模的研究方向
- 為其他資料集整合提供參考架構

### 學術影響
- 在METR-LA基準上的競爭性結果
- 多特徵社交池化的首次完整展示
- 跨資料集分析的新穎洞察

### 實用影響
- 台灣交通管理系統的潛在應用
- 政府決策支援的資料驅動方法
- 真實世界交通預測系統的參考實現

## 相關ADR
- ADR-0100: Social Pooling vs Graph Networks
- ADR-0101: xLSTM vs Traditional LSTM  
- ADR-0200: 座標系統選擇
- ADR-0300: 下一階段開發優先級

## 版本歷史
- v1.0 (2025-01-22): 初始決策記錄
- 決策基於：Zen多模型深度分析 + 技術可行性評估