# æ ¸å¿ƒæŠ€è¡“æ±ºç­–

æœ¬æ–‡æª”æ•´åˆäº† Social-xLSTM å°ˆæ¡ˆçš„é—œéµæž¶æ§‹å’ŒæŠ€è¡“æ±ºç­–ï¼Œç‚ºé–‹ç™¼è€…æä¾›æ¸…æ™°çš„æŠ€è¡“æ–¹å‘æŒ‡å¼•ã€‚

## æ±ºç­–æ¦‚è¦½

Social-xLSTM å°ˆæ¡ˆçš„æ ¸å¿ƒå‰µæ–°åœç¹žå…©å€‹é—œéµé¸æ“‡ï¼š
1. **Social Pooling** - ç„¡æ‹“æ’²ä¾è³´çš„ç©ºé–“å»ºæ¨¡æ–¹æ³•
2. **xLSTM** - æ“´å±•è¨˜æ†¶å®¹é‡çš„æ™‚åºå»ºæ¨¡æž¶æ§‹

## æ ¸å¿ƒæŠ€è¡“æ±ºç­–

### 1. ç©ºé–“å»ºæ¨¡æ–¹æ³•ï¼šSocial Pooling vs Graph Networks

**æ±ºç­–**: é¸æ“‡ Social Pooling ä½œç‚ºç©ºé–“äº’å‹•å»ºæ¨¡æ–¹æ³•

**èƒŒæ™¯**:
å‚³çµ±äº¤é€šé æ¸¬ä¾è³´é å®šç¾©çš„é“è·¯æ‹“æ’²åœ–çµæ§‹ï¼Œä½†åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œå®Œæ•´çš„é“è·¯æ‹“æ’²è³‡è¨Šå¾€å¾€ä¸å¯ç”¨æˆ–ä¸æº–ç¢ºã€‚å°ç£å…¬è·¯ç¸½å±€çš„äº¤é€šè³‡æ–™ç¼ºä¹å®Œæ•´æ‹“æ’²è³‡è¨Šï¼Œæ„Ÿæ¸¬å™¨åˆ†ä½ˆä¸è¦å‰‡ã€‚

**æ ¸å¿ƒåŽŸç†**:
```python
def social_pooling(node_features, coordinates, radius):
    # 1. è¨ˆç®—è·é›¢çŸ©é™£ï¼ˆåŸºæ–¼åº§æ¨™ï¼‰
    distances = compute_distance_matrix(coordinates)
    
    # 2. ç”Ÿæˆç©ºé–“æ¬Šé‡ï¼ˆé«˜æ–¯æ ¸å‡½æ•¸ï¼‰
    spatial_weights = gaussian_kernel(distances, radius)
    
    # 3. åŠ æ¬Šèšåˆé„°å±…ç‰¹å¾µ
    pooled_features = weighted_aggregation(node_features, spatial_weights)
    
    return pooled_features
```

**å„ªå‹¢**:
- **ç„¡æ‹“æ’²ä¾è³´**: ç´”ç²¹åŸºæ–¼åº§æ¨™çš„ç©ºé–“é—œä¿‚å­¸ç¿’
- **é©æ‡‰ä¸è¦å‰‡åˆ†ä½ˆ**: æ„Ÿæ¸¬å™¨ä½ç½®ä¸è¦å‰‡æ™‚ä»èƒ½æœ‰æ•ˆå·¥ä½œ
- **å‹•æ…‹æ“´å±•**: æ˜“æ–¼æ·»åŠ æ–°çš„ç©ºé–“ç¯€é»ž
- **å¯è§£é‡‹æ€§**: åŸºæ–¼ç‰©ç†è·é›¢çš„ç›´è§€ç†è§£

**æŠ€è¡“åŸºç¤Ž**: åº§æ¨™é©…å‹•çš„ç©ºé–“èšåˆï¼Œä½¿ç”¨æ­å¹¾é‡Œå¾—è·é›¢å’Œé«˜æ–¯æ¬Šé‡å‡½æ•¸

---

### 2. æ™‚åºæ¨¡åž‹é¸æ“‡ï¼šxLSTM vs Traditional LSTM

**æ±ºç­–**: é¸æ“‡ xLSTM (Extended LSTM) ä½œç‚ºæ ¸å¿ƒæ™‚åºæ¨¡åž‹

**èƒŒæ™¯**:
å‚³çµ± LSTM åœ¨æ™‚é–“åºåˆ—é æ¸¬ä¸­è¡¨ç¾ç©©å®šï¼Œä½†è¨˜æ†¶å®¹é‡æœ‰é™ï¼Œé›£ä»¥è™•ç†é•·åºåˆ—ä¾è³´ã€‚xLSTM æä¾›æ›´å¼·çš„å»ºæ¨¡èƒ½åŠ›å’Œæ›´å¤§çš„è¨˜æ†¶å®¹é‡ã€‚

**æž¶æ§‹è¨­è¨ˆ**:
```python
class SocialXLSTM(nn.Module):
    def __init__(self, config):
        # sLSTM è™•ç†å–®è®Šé‡æ™‚é–“åºåˆ—
        self.temporal_encoder = sLSTM(
            input_size=config.input_size,
            hidden_size=config.hidden_size,
            num_layers=config.num_layers
        )
        
        # mLSTM è™•ç†å¤šè®Šé‡ç©ºé–“ç‰¹å¾µ
        self.spatial_encoder = mLSTM(
            input_size=config.spatial_size,
            hidden_size=config.hidden_size
        )
```

**å„ªå‹¢**:
- **æ··åˆæž¶æ§‹**: sLSTM + mLSTM åˆ†åˆ¥è™•ç†æ™‚åºå’Œç©ºé–“ç‰¹å¾µ
- **æŒ‡æ•¸é–€æŽ§**: æä¾›æ›´å¤§çš„è¨˜æ†¶å®¹é‡
- **é•·æœŸä¾è³´**: æ›´å¥½çš„é•·åºåˆ—å»ºæ¨¡èƒ½åŠ›
- **ç ”ç©¶å‰µæ–°**: çµåˆæœ€æ–°çš„ LSTM æ“´å±•æŠ€è¡“

**æŠ€è¡“åŸºç¤Ž**: xlstm åº«æä¾›çš„ sLSTM (scalar LSTM) å’Œ mLSTM (matrix LSTM)

---

### 3. åº§æ¨™ç³»çµ±é¸æ“‡ï¼šå¢¨å¡æ‰˜æŠ•å½± vs UTM

**æ±ºç­–**: ä½¿ç”¨ç¾æœ‰çš„å¢¨å¡æ‰˜æŠ•å½±åº§æ¨™ç³»çµ±

**èƒŒæ™¯**:
Social Pooling éœ€è¦æº–ç¢ºçš„å¹³é¢åº§æ¨™ç³»çµ±é€²è¡Œè·é›¢è¨ˆç®—å’Œç¶²æ ¼åŠƒåˆ†ã€‚å°ˆæ¡ˆä¸­å·²æœ‰å®Œæ•´çš„åº§æ¨™è™•ç†å¯¦ç¾ã€‚

**æŠ€è¡“è¦æ ¼**:
- **æŠ•å½±æ–¹å¼**: å¢¨å¡æ‰˜æŠ•å½±ï¼Œä»¥å°ç£å—æŠ•ç‚ºåŽŸé»ž
- **å¯¦ç¾ä½ç½®**: `src/social_xlstm/utils/spatial_coords.py`
- **åŠŸèƒ½**: é›™å‘è½‰æ›ã€è·é›¢è¨ˆç®—ã€æ–¹ä½è§’è¨ˆç®—
- **å„ªå‹¢**: å·²æ¸¬è©¦ç©©å®šï¼Œç«‹å³å¯ç”¨

**é¸æ“‡ç†ç”±**:
- **å®Œæ•´å¯¦ç¾**: 437 è¡Œä»£ç¢¼ï¼ŒåŠŸèƒ½å…¨é¢
- **é©åˆå°ç£**: ä»¥å—æŠ•ç‚ºåŽŸé»žï¼Œé©åˆå°ç£åœ°å€
- **å³ç”¨æ€§**: ç„¡éœ€é¡å¤–é–‹ç™¼ï¼Œé™ä½Žå¯¦æ–½é¢¨éšª
- **ç²¾åº¦è¶³å¤ **: å°æ–¼äº¤é€šé æ¸¬æ‡‰ç”¨ç²¾åº¦å……è¶³

---

### 4. å¯¦æ–½æž¶æ§‹ï¼šåŒ…è£å™¨æ¨¡å¼ vs æ·±åº¦æ•´åˆ

**æ±ºç­–**: æŽ¡ç”¨åŒ…è£å™¨æ¨¡å¼ + Post-Fusion ç­–ç•¥

**èƒŒæ™¯**:
éœ€è¦å°‡ Social Pooling èˆ‡ç¾æœ‰çš„ LSTM/xLSTM æ¨¡åž‹æ•´åˆï¼Œè€ƒæ…®å¯¦æ–½è¤‡é›œåº¦å’Œé¢¨éšªæŽ§åˆ¶ã€‚

**æž¶æ§‹è¨­è¨ˆ**:
```python
class SocialTrafficModel(nn.Module):
    def __init__(self, base_model: TrafficLSTM, social_pooling: SocialPooling):
        super().__init__()
        self.base_model = base_model      # å¾©ç”¨ç¾æœ‰æ¨¡åž‹
        self.social_pooling = social_pooling
        self.fusion_layer = nn.Linear(...)
    
    def forward(self, x, coordinates, vd_ids):
        # 1. åŸºç¤Žæ¨¡åž‹è™•ç†
        base_output = self.base_model(x)
        
        # 2. Social Pooling
        social_features = self.social_pooling(x, coordinates, vd_ids)
        
        # 3. ç‰¹å¾µèžåˆ
        fused = torch.cat([base_output, social_features], dim=-1)
        return self.fusion_layer(fused)
```

**å„ªå‹¢**:
- **é¢¨éšªæŽ§åˆ¶**: ä¸ä¿®æ”¹ç¾æœ‰ç©©å®šä»£ç¢¼
- **ä»£ç¢¼å¾©ç”¨**: æœ€å¤§åŒ–åˆ©ç”¨ç¾æœ‰ 900+ è¡Œç©©å®šå¯¦ç¾
- **æ¼¸é€²å¯¦ç¾**: å¯åˆ†éšŽæ®µé©—è­‰å’Œå„ªåŒ–
- **ç¶­è­·æ€§**: æ¸…æ™°çš„æ¨¡çµ„åŒ–è¨­è¨ˆ

---

### 5. è©•ä¼°ç­–ç•¥ï¼šé›™è³‡æ–™é›†æž¶æ§‹

**æ±ºç­–**: æ”¯æ´ METR-LA èˆ‡å°ç£äº¤é€šè³‡æ–™çš„çµ±ä¸€è©•ä¼°

**èƒŒæ™¯**:
ç‚ºäº†é©—è­‰æ–¹æ³•çš„é€šç”¨æ€§å’Œé€²è¡Œåœ‹éš›æ¯”è¼ƒï¼Œéœ€è¦æ”¯æ´å¤šç¨®äº¤é€šè³‡æ–™é›†ã€‚

**æž¶æ§‹å„ªå‹¢**:
- **åœ‹éš›æ¯”è¼ƒ**: METR-LA æ˜¯æ¨™æº–åŸºæº–è³‡æ–™é›†
- **æœ¬åœŸé©—è­‰**: å°ç£è³‡æ–™è­‰æ˜Žå¯¦éš›æ‡‰ç”¨åƒ¹å€¼
- **æ–¹æ³•é©—è­‰**: è­‰æ˜Žç„¡æ‹“æ’²æ–¹æ³•çš„é€šç”¨æ€§
- **ç ”ç©¶åƒ¹å€¼**: æä¾›å®Œæ•´çš„è©•ä¼°åŸºç¤Ž

## å¯¦æ–½å„ªå…ˆç´š

### P0: æ ¸å¿ƒåŠŸèƒ½å¯¦ç¾
1. **Social Pooling ç®—æ³•** - åŸºæ–¼ç¾æœ‰åº§æ¨™ç³»çµ±å¯¦ç¾
2. **åŒ…è£å™¨æ¨¡å¼æ•´åˆ** - èˆ‡ TrafficLSTM æ•´åˆ
3. **åŸºæœ¬æ¸¬è©¦é©—è­‰** - ç¢ºä¿åŠŸèƒ½æ­£ç¢ºæ€§

### P1: æ“´å±•åŠŸèƒ½
1. **xLSTM æ¨¡åž‹æ•´åˆ** - æ›¿æ› LSTM ç‚º xLSTM
2. **å¤š VD æ”¯æ´** - æ”¯æ´å¤šè»Šé“æª¢æ¸¬å™¨å ´æ™¯
3. **æ€§èƒ½å„ªåŒ–** - è¨˜æ†¶é«”å’Œè¨ˆç®—æ•ˆçŽ‡å„ªåŒ–

### P2: é©—è­‰è©•ä¼°
1. **åŸºæº–æ¯”è¼ƒ** - èˆ‡å‚³çµ±æ–¹æ³•æ¯”è¼ƒ
2. **å¤šè³‡æ–™é›†é©—è­‰** - METR-LA å’Œå°ç£è³‡æ–™
3. **ç ”ç©¶åˆ†æž** - è©³ç´°çš„æ•ˆæžœåˆ†æžå ±å‘Š

## æŠ€è¡“åŸºç¤Žè¨­æ–½

### å·²å°±ç·’çš„çµ„ä»¶
- âœ… **åº§æ¨™ç³»çµ±**: `spatial_coords.py` (437 è¡Œï¼ŒåŠŸèƒ½å®Œæ•´)
- âœ… **çµ±ä¸€ LSTM**: `lstm.py` (477 è¡Œï¼Œç©©å®š)
- âœ… **è©•ä¼°æ¡†æž¶**: `evaluator.py` (å®Œå–„)
- âœ… **è¨“ç·´ç³»çµ±**: `trainer.py` (çµ±ä¸€)
- âœ… **æ•¸æ“šç®¡ç·š**: å®Œæ•´çš„ XML â†’ JSON â†’ HDF5 è™•ç†

### å¾…å¯¦ç¾çš„çµ„ä»¶
- ðŸš§ **Social Pooling**: æ ¸å¿ƒç©ºé–“èšåˆç®—æ³•
- ðŸš§ **xLSTM æ•´åˆ**: sLSTM + mLSTM æ··åˆæž¶æ§‹
- ðŸš§ **Social-xLSTM**: å®Œæ•´çš„æ•´åˆæ¨¡åž‹

## é¢¨éšªè©•ä¼°èˆ‡ç·©è§£

### æŠ€è¡“é¢¨éšª
1. **æ–°æ–¹æ³•ä¸ç¢ºå®šæ€§**: Social Pooling æ•ˆæžœæœªçŸ¥
   - **ç·©è§£**: å»ºç«‹å®Œæ•´çš„åŸºæº–æ¯”è¼ƒå’Œè©•ä¼°æ©Ÿåˆ¶

2. **è¨ˆç®—è¤‡é›œåº¦**: è·é›¢è¨ˆç®—å¯èƒ½æ˜‚è²´
   - **ç·©è§£**: æä¾› max_neighbors åƒæ•¸é™åˆ¶ï¼Œä½¿ç”¨å¿«å–æ©Ÿåˆ¶

3. **è¨˜æ†¶é«”ä½¿ç”¨**: xLSTM è¨˜æ†¶é«”éœ€æ±‚è¼ƒé«˜
   - **ç·©è§£**: æ‰¹æ¬¡å¤§å°èª¿å„ªï¼Œæ¢¯åº¦ç´¯ç©ç­–ç•¥

### å¯¦æ–½é¢¨éšª
1. **åº§æ¨™æ•¸æ“šç›¸å®¹æ€§**: VD åº§æ¨™æ ¼å¼ä¸åŒ¹é…
   - **ç·©è§£**: å¯¦æ–½å‰é©—è­‰ç¾æœ‰æ•¸æ“šæ ¼å¼

2. **æ¨¡åž‹è¨“ç·´ç©©å®šæ€§**: æ–°æž¶æ§‹å¯èƒ½ä¸æ”¶æ–‚
   - **ç·©è§£**: å…ˆç¢ºä¿åŸºæº–æ¨¡åž‹æ­£å¸¸ï¼Œæ¼¸é€²å¢žåŠ è¤‡é›œåº¦

## æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™
- **æº–ç¢ºæ€§**: MAE/RMSE æ¯”åŸºæº– LSTM æ”¹å–„ > 5%
- **æ•ˆçŽ‡**: è¨˜æ†¶é«”ä½¿ç”¨å¢žé•· < 50%ï¼Œè¨“ç·´æ™‚é–“å¢žé•· < 30%
- **ç©©å®šæ€§**: æ¨¡åž‹ç©©å®šæ”¶æ–‚ï¼Œç„¡éŽæ“¬åˆç¾è±¡

### ç ”ç©¶æŒ‡æ¨™
- **å‰µæ–°æ€§**: ç„¡æ‹“æ’²äº¤é€šé æ¸¬æ–°æ–¹æ³•
- **é€šç”¨æ€§**: æ”¯æ´å¤šç¨®è³‡æ–™é›†å’Œå ´æ™¯
- **å¯¦ç”¨æ€§**: é©æ‡‰çœŸå¯¦ä¸–ç•Œçš„ä¸å®Œæ•´è³‡è¨Š

## ç›¸é—œæ–‡ç»èˆ‡ä¾æ“š

- **Social LSTM**: Alahi, A., et al. (2016). Social LSTM: Human trajectory prediction in crowded spaces.
- **xLSTM**: Beck, M., et al. (2024). xLSTM: Extended Long Short-Term Memory.
- **Traffic Prediction**: Li, Y., et al. (2018). Diffusion convolutional recurrent neural network.

---

**æ±ºç­–ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2025-01-15  
**ç‹€æ…‹**: å·²ç¢ºèªå¯¦æ–½

*æœ¬æ–‡æª”æ•´åˆäº†å°ˆæ¡ˆçš„æ ¸å¿ƒæŠ€è¡“æ±ºç­–ï¼Œç‚ºé–‹ç™¼æä¾›çµ±ä¸€çš„æŠ€è¡“æ–¹å‘æŒ‡å¼•ã€‚è©³ç´°çš„æ±ºç­–éŽç¨‹å’ŒèƒŒæ™¯è³‡æ–™ä¿å­˜åœ¨åŽŸå§‹ ADR æ–‡æª”ä¸­ã€‚*