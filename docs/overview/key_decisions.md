# 關鍵決策記錄

本文檔記錄 Social-xLSTM 專案開發過程中的重要技術決策和設計選擇。

## 🏗️ 架構決策

### 1. Social Pooling vs. Graph-based 方法
**決策時間**：專案初期（基於期中報告）  
**選擇**：採用 Social Pooling 機制  
**理由**：
- 🎯 **解決核心問題**：現有時空圖模型依賴完整拓撲資訊
- 🔄 **自動學習**：無需預先定義鄰接矩陣或道路拓撲
- 📍 **座標驅動**：僅需固定座標即可學習空間互動
- 🚀 **創新性**：將行人軌跡預測概念延伸到交通流量預測

**替代方案**：
- Graph Convolutional Networks (GCN)
- Spatial-Temporal Graph Networks
- Attention-based 空間建模

### 2. xLSTM vs. 傳統 LSTM
**決策時間**：專案規劃階段  
**選擇**：採用 Hybrid xLSTM (sLSTM + mLSTM)  
**理由**：
- 💾 **高容量記憶**：矩陣記憶突破單向量限制
- ✏️ **可重寫機制**：指數門控支援記憶覆寫
- ⚡ **並行計算**：mLSTM 無記憶混合，支援並行
- 🔬 **學術前沿**：採用最新的 LSTM 擴展技術

**效能預期**：
- 更好的長序列建模能力
- 對突發交通事件的敏感性提升
- 記憶容量擴展帶來的準確度改善

### 3. 數據格式選擇
**決策時間**：數據處理階段  
**選擇**：XML → JSON → HDF5 管線  
**理由**：
- 📂 **源數據格式**：台灣公路總局提供 XML 格式
- 🔄 **中間格式**：JSON 便於處理和驗證
- ⚡ **最終格式**：HDF5 提供高效的時間序列存取
- 🗂️ **空間最佳化**：按地區分塊存儲提升載入速度

**替代方案考慮**：
- 直接 XML → HDF5（跳過 JSON 中間步驟）
- 使用 Parquet 或其他列式存儲格式

## 📊 數據決策

### 1. 目標區域選擇
**決策時間**：數據預處理階段  
**選擇**：高屏交界處監測站  
**理由**：
- 🌐 **節點分布**：相對分散，不像其他區域過於壅擠
- 🚗 **交通特性**：模擬一般市區車流狀況
- 📍 **地理優勢**：跨縣市邊界，具有代表性
- 🔍 **研究適合性**：適合驗證不規則節點分佈的處理能力

**數據統計**：
- 監測站數量：待統計
- 數據時間跨度：約 1.5 個月
- 總記錄數：66,371 筆

### 2. 特徵工程策略
**決策時間**：模型設計階段  
**選擇**：多維度特徵組合  
**特徵組成**：
```
輸入特徵 = [
    當前流量 (qt),
    車道佔用率 (pt), 
    車道速度 (st),
    車道數 (ℓi),
    時段特徵 (ti)
]
```

**設計考量**：
- 🚦 **核心交通指標**：流量、速度、佔用率是交通分析基礎
- 🛣️ **基礎設施**：車道數反映道路容量
- ⏰ **時間模式**：時段特徵捕捉週期性變化

## 🛠️ 實現決策

### 1. 深度學習框架選擇
**決策時間**：開發初期  
**選擇**：PyTorch + PyTorch Lightning  
**理由**：
- 🔧 **靈活性**：PyTorch 提供動態圖和靈活的模型定義
- ⚡ **高效訓練**：Lightning 簡化訓練流程和分散式支援
- 📚 **社群支援**：豐富的學術資源和預訓練模型
- 🔗 **xLSTM 相容性**：xlstm 庫基於 PyTorch 實現

**替代方案**：
- TensorFlow/Keras
- JAX/Flax

### 2. 專案結構設計
**決策時間**：專案整理階段  
**選擇**：模組化 src/ 佈局  
**結構原則**：
```
src/social_xlstm/
├── dataset/      # 數據處理
├── models/       # 模型實現  
├── evaluation/   # 評估框架
├── utils/        # 工具函數
└── visualization/ # 視覺化
```

**設計考量**：
- 🎯 **單一職責**：每個模組有明確的功能邊界
- 🔄 **可重用性**：組件可獨立使用和測試
- 📦 **封裝性**：清晰的 API 接口設計
- 🧪 **可測試性**：便於單元測試和整合測試

### 3. 文檔系統設計
**決策時間**：2025-01-08  
**選擇**：分類式文檔結構  
**組織原則**：
- 📋 **overview/**：專案概覽和介紹
- 🔬 **technical/**：深度技術文檔（LaTeX 數學公式）
- 💻 **implementation/**：實現相關文檔
- 📊 **reports/**：報告和分析文檔

**關鍵決策**：
- ✅ **LaTeX 數學公式**：選擇 .tex 而非 .md，確保專業數學排版
- ❌ **移除數字前綴**：避免 01-, 02- 前綴，使用直觀名稱
- 🗂️ **導覽系統**：創建 docs/README.md 統一入口

## ⚠️ 風險與挑戰

### 技術風險
1. **xLSTM 複雜度**：實現複雜，調試困難
2. **計算資源**：矩陣記憶可能帶來計算負擔
3. **超參數敏感性**：網格大小、記憶維度等參數調優

### 數據風險  
1. **數據品質**：部分時段可能有缺失或異常值
2. **區域代表性**：高屏地區是否能泛化到其他區域
3. **時間跨度**：1.5 個月數據是否足夠捕捉季節性變化

### 專案風險
1. **時程壓力**：學期末前完成所有實驗驗證
2. **程式碼債務**：現有重複代碼需要緊急清理
3. **效能基準**：需要建立可信的比較基準

## 🎯 成功指標

### 技術指標
- **預測準確度**：MAE, RMSE, MAPE 等指標優於基準
- **計算效率**：推理時間和記憶體使用合理
- **穩定性**：不同初始化下結果一致性

### 學術指標  
- **創新性**：Social Pooling 在交通預測的首次應用
- **泛化性**：模型在不同區域和時段的適應能力
- **可解釋性**：能夠分析學習到的空間互動模式

### 專案指標
- **代碼品質**：測試覆蓋率 > 70%，無重複代碼
- **文檔完整性**：所有核心功能有清晰文檔
- **可重現性**：實驗結果可重現，配置清晰

## 📚 參考依據

### 學術文獻
- **Social LSTM**：Alahi et al., "Social LSTM: Human trajectory prediction in crowded spaces" (CVPR 2016)
- **xLSTM**：Beck et al., "xLSTM: Extended Long Short-Term Memory" (arXiv 2024)

### 技術文檔
- PyTorch Lightning 官方文檔
- xlstm 庫實現文檔
- 台灣公路總局數據 API 規範

### 專案文檔
- 國立臺南大學資訊工程學系期中進度報告書
- Social-xLSTM 數學公式定義 (mathematical_formulation.tex)