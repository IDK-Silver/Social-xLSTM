# 機器學習訓練指標完全指南

## 📖 概述

本指南專為初學者設計，詳細解釋機器學習模型訓練中的各種評估指標，以及如何解讀訓練過程中生成的圖表。

## 🧮 核心評估指標詳解

### 1. 損失函數 (Loss)

**🎯 目的**: 衡量模型預測與真實值的差距

**📐 公式**: 通常使用均方誤差 (MSE)
```
Loss = MSE = (1/n) × Σ(預測值 - 真實值)²
```

**🔍 如何理解**:
- 想像你在射箭，損失就是你射中的位置與靶心的距離
- 數值越小 = 射得越準 = 模型越好
- 理想情況：損失接近 0

**📊 正常表現**:
- ✅ **好的趨勢**: 隨著訓練進行，損失持續下降
- ❌ **壞的趨勢**: 損失不降反升，或者震盪很大

---

### 2. MAE (Mean Absolute Error) - 平均絕對誤差

**🎯 目的**: 衡量預測誤差的平均大小，用最直觀的方式

**📐 公式**:
```
MAE = (1/n) × Σ|預測值 - 真實值|
```

**🔍 如何理解**:
- 就像計算"平均錯多少"
- 例如：預測交通流量是 100，實際是 80，誤差就是 20
- 單位與原始數據相同（比如：車輛數、速度等）

**📊 實際例子**:
- 預測車速：MAE = 5 表示平均錯 5 公里/小時
- 預測車流量：MAE = 10 表示平均錯 10 輛車

**✅ 優點**: 容易理解，不會被極端值嚴重影響
**❌ 缺點**: 對所有錯誤一視同仁，不會特別懲罰大錯誤

---

### 3. MSE (Mean Squared Error) - 均方誤差

**🎯 目的**: 衡量預測誤差，但對大錯誤懲罰更重

**📐 公式**:
```
MSE = (1/n) × Σ(預測值 - 真實值)²
```

**🔍 如何理解**:
- 先計算誤差，再平方，最後求平均
- 因為平方的關係，大錯誤會被放大很多倍
- 例如：錯 2 變成 4，錯 10 變成 100

**📊 與 MAE 的關係**:
- MSE 總是 ≥ MAE
- 如果 MSE 比 MAE 大很多 → 表示有一些很大的錯誤
- 如果 MSE 接近 MAE → 表示錯誤比較均勻

**✅ 優點**: 重點關注大錯誤，數學性質好
**❌ 缺點**: 單位是原始數據的平方，不直觀

---

### 4. RMSE (Root Mean Squared Error) - 均方根誤差

**🎯 目的**: 結合 MSE 的優點，但單位更直觀

**📐 公式**:
```
RMSE = √MSE = √[(1/n) × Σ(預測值 - 真實值)²]
```

**🔍 如何理解**:
- 就是 MSE 開根號
- 單位回到與原始數據相同
- 仍然對大錯誤有更多懲罰

**📊 比較 MAE 和 RMSE**:
- RMSE > MAE：有一些較大的錯誤
- RMSE ≈ MAE：錯誤分佈比較均勻
- RMSE >> MAE：有很多大錯誤，需要注意

---

### 5. MAPE (Mean Absolute Percentage Error) - 平均絕對百分比誤差

**🎯 目的**: 用百分比表示誤差，便於跨不同規模數據比較

**📐 公式**:
```
MAPE = (1/n) × Σ|(真實值 - 預測值) / 真實值| × 100%
```

**🔍 如何理解**:
- 告訴你"平均錯了百分之多少"
- 例如：MAPE = 10% 表示平均錯 10%
- 可以跨不同數據規模比較

**📊 實際例子**:
- 預測車速 80，實際 100：錯誤 = |100-80|/100 = 20%
- 預測車流 200，實際 250：錯誤 = |250-200|/250 = 20%

**✅ 優點**: 百分比形式，直觀易懂
**❌ 缺點**: 當真實值接近 0 時會出現極大值或無窮大

**⚠️ 特殊情況**:
- MAPE = Infinity：表示有真實值為 0 的情況
- MAPE > 100%：表示有預測非常不準確的情況

---

### 6. R² (R-squared) - 決定係數

**🎯 目的**: 衡量模型解釋了多少變異，是"模型好壞"的綜合指標

**📐 公式**:
```
R² = 1 - (實際誤差平方和 / 總變異平方和)
   = 1 - [Σ(真實值 - 預測值)²] / [Σ(真實值 - 平均值)²]
```

**🔍 如何理解**:
- 告訴你模型比"簡單猜平均值"好多少
- 範圍從 -∞ 到 1
- 可以理解為"解釋變異的百分比"

**📊 分數解讀**:
- **R² = 1.0**: 完美預測 🎯
- **R² = 0.9**: 解釋了 90% 的變異，非常好 ⭐⭐⭐⭐⭐
- **R² = 0.7**: 解釋了 70% 的變異，良好 ⭐⭐⭐⭐
- **R² = 0.5**: 解釋了 50% 的變異，一般 ⭐⭐⭐
- **R² = 0.0**: 等同於猜平均值 ⭐⭐
- **R² < 0**: 比猜平均值還差 ⭐

**🔍 實際意義**:
- R² = 0.8 表示：如果數據有 100 單位的變異，模型解釋了 80 單位
- 剩下的 20 單位變異是模型無法解釋的（可能是隨機因素）

---

## 📊 圖表解讀指南

### 圖表 1: `training_curves.png` - 基本訓練曲線

**🎯 目的**: 監控訓練過程是否正常

#### 子圖 1: 訓練/驗證損失 (左上)
```
📈 圖表內容:
- 藍線：訓練損失
- 紅線：驗證損失  
- 綠星：最佳 epoch
```

**✅ 正常情況應該看到**:
1. **藍線（訓練損失）**: 穩定下降
2. **紅線（驗證損失）**: 先下降，然後穩定
3. **兩線關係**: 驗證損失不應該比訓練損失高太多

**🚨 警告信號**:
- 紅線上升而藍線下降 → **過擬合**
- 兩線都很高且不下降 → **欠擬合**
- 線條劇烈震盪 → **學習率太高**

#### 子圖 2: MAE 演變 (右上)
```
📈 圖表內容:
- 藍線：訓練 MAE
- 紅線：驗證 MAE
```

**🔍 如何看**:
- 數值越小越好
- 注意訓練和驗證的差距
- 與左上角的損失趨勢應該一致

#### 子圖 3: 學習率調度 (左下)
```
📈 圖表內容:
- 綠線：學習率隨時間變化
```

**🔍 如何看**:
- 通常是水平線（固定學習率）
- 有時會看到階梯狀下降（學習率衰減）
- 確認學習率設置是否合理

---

### 圖表 2: `metric_evolution.png` - 評估指標演變

**🎯 目的**: 詳細監控各種評估指標

#### 四個子圖詳解:

**子圖 1: MAE 演變 (左上)**
- 看趨勢：應該下降
- 看數值：根據你的數據判斷是否合理
- 比較訓練/驗證：差距不應該太大

**子圖 2: MSE 演變 (右上)**  
- 與 MAE 趨勢應該一致
- 如果 MSE 下降很快但 MAE 下降緩慢 → 主要是減少了大錯誤

**子圖 3: RMSE 演變 (左下)**
- 與 MSE 趨勢相同，但數值更直觀
- 可以直接與 MAE 比較大小

**子圖 4: R² 演變 (右下)**
- **最重要的指標**
- 訓練 R² 應該接近 1
- 驗證 R² 應該 > 0，且不要比訓練 R² 差太多

**🚨 重點關注 R² 圖**:
```
✅ 理想情況:
- 訓練 R² = 0.9，驗證 R² = 0.8 → 很好！

⚠️ 需要注意:
- 訓練 R² = 0.9，驗證 R² = 0.3 → 過擬合
- 訓練 R² = 0.9，驗證 R² = -2 → 嚴重過擬合

❌ 有問題:
- 訓練 R² = 0.3，驗證 R² = 0.2 → 欠擬合
- R² = 0 或異常值 → 數據問題
```

---

### 圖表 3: `advanced_metrics.png` - 進階指標分析

**🎯 目的**: 深入分析模型性能和訓練穩定性

#### 子圖 1: 所有指標演變 (上方大圖)
```
📈 圖表內容:
- 多條線顯示所有指標
- 顏色區分訓練/驗證
```

**🔍 如何看**:
- 整體趨勢：所有線都應該朝"好"的方向發展
- 相對位置：驗證指標不應該偏離訓練指標太多
- 注意異常的線（比如 MAPE 特別高）

#### 子圖 2: 記憶體使用 (右中)
```
📈 圖表內容:
- 紅線：GPU 記憶體使用量 (MB)
```

**🔍 如何看**:
- 正常：穩定或緩慢上升
- 異常：急劇上升（可能有記憶體洩漏）

#### 子圖 3: 收斂分析 (左下)
```
📈 圖表內容:
- 藍線：實際損失變化
- 紅虛線：趨勢線
- 顯示收斂趨勢數值
```

**🔍 如何看**:
- 趨勢線向下：模型在改善
- 趨勢線平穩：模型收斂了
- 趨勢線向上：可能有問題

#### 子圖 4: 過擬合分析 (右下)
```
📈 圖表內容:
- 粉色填充：過擬合程度
- 顯示驗證損失 - 訓練損失的差距
```

**🔍 如何看**:
- 粉色區域越小越好
- 粉色區域擴大：過擬合加劇
- 理想情況：粉色區域很小且穩定

---

## 🔍 實際案例：如何解讀當前結果

基於你的訓練結果，讓我們實際分析：

### 當前數據
```
訓練 R² = 0.93-0.94    驗證 R² = -6 到 -8
訓練 MAE = 0.24-0.35   驗證 MAE = 1.8-2.0
```

### 診斷步驟

**步驟 1: 看 R²**
- 訓練 R² = 0.93 ✅ 非常好，模型學習能力強
- 驗證 R² = -6 ❌ 非常差，比隨機猜測還差

**步驟 2: 看 MAE**  
- 訓練 MAE = 0.3 ✅ 相對較小
- 驗證 MAE = 1.9 ❌ 是訓練的 6 倍多

**步驟 3: 比較差距**
- R² 差距：0.93 - (-6) = 6.93 ❌ 差距巨大
- MAE 差距：1.9 / 0.3 = 6.3 倍 ❌ 差距過大

### 結論
🚨 **嚴重過擬合！** 模型在訓練數據上表現優秀，但在新數據上完全失效。

### 解決方案優先級
1. **立即採取**：增加 Dropout 到 0.4-0.5
2. **中期調整**：減少模型複雜度（減少隱藏層大小）
3. **長期改進**：收集更多訓練數據

---

## 🎯 總結：好模型的標準

### ✅ 理想的指標表現
```
損失：      ↓ 穩定下降，最終穩定在低值
MAE/RMSE：  ↓ 數值合理，訓練/驗證接近
MAPE：      ↓ 低於 20%（依應用而定）
R²：        ↑ 訓練 > 0.8，驗證 > 0.6，差距 < 0.2
```

### 🚨 需要警惕的信號
```
過擬合：    訓練指標優秀，驗證指標很差
欠擬合：    所有指標都不好
不穩定：    指標劇烈震盪
數據問題：  異常值（如 MAPE = Infinity）
```

### 📈 改進的一般策略
1. **過擬合** → 正規化、早停、更多數據
2. **欠擬合** → 增加複雜度、減少正規化
3. **不穩定** → 降低學習率、批次標準化
4. **數據問題** → 檢查預處理、清理異常值

記住：機器學習是一個迭代過程，需要不斷調整和改進！