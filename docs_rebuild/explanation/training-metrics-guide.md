# 訓練指標完全理解指南

本指南詳細解釋機器學習模型訓練中的各種評估指標含義，幫助你正確解讀訓練過程。

## 📊 核心評估指標

### 1. 損失函數 (Loss)

**🎯 目的**: 衡量模型預測與真實值的差距

**📐 公式**: 通常使用均方誤差 (MSE)
```
Loss = MSE = (1/n) × Σ(預測值 - 真實值)²
```

**🔍 直觀理解**:
- 想像射箭：損失 = 箭矢與靶心的距離
- 數值越小 = 射得越準 = 模型越好
- 理想情況：損失接近 0

**📈 正常表現**:
- ✅ **好趨勢**: 損失隨訓練持續下降
- ❌ **壞趨勢**: 損失上升或劇烈震盪

---

### 2. MAE (Mean Absolute Error) - 平均絕對誤差

**🎯 目的**: 最直觀的誤差衡量方式

**📐 公式**:
```
MAE = (1/n) × Σ|預測值 - 真實值|
```

**🔍 實際含義**:
- 就是「平均錯多少」
- 單位與原始數據相同
- 例如：預測車速 MAE = 5 → 平均錯 5 公里/小時

**✅ 優點**: 容易理解，不會被極端值嚴重影響
**❌ 缺點**: 對所有錯誤一視同仁

---

### 3. MSE (Mean Squared Error) - 均方誤差

**🎯 目的**: 懲罰大錯誤的損失函數

**📐 公式**:
```
MSE = (1/n) × Σ(預測值 - 真實值)²
```

**🔍 特殊性質**:
- 因為平方：大錯誤被放大很多倍
- 錯 2 變成 4，錯 10 變成 100
- MSE 總是 ≥ MAE

**📊 與 MAE 關係**:
- MSE >> MAE → 有很多大錯誤
- MSE ≈ MAE → 錯誤分佈均勻

---

### 4. RMSE (Root Mean Squared Error) - 均方根誤差

**🎯 目的**: MSE 的直觀版本

**📐 公式**:
```
RMSE = √MSE
```

**🔍 優勢**:
- 單位回到與原始數據相同
- 仍然對大錯誤有更多懲罰
- 比 MSE 更直觀

**📊 解讀原則**:
- RMSE > MAE：存在較大錯誤
- RMSE ≈ MAE：錯誤分佈均勻

---

### 5. MAPE (Mean Absolute Percentage Error) - 平均絕對百分比誤差

**🎯 目的**: 用百分比表示誤差

**📐 公式**:
```
MAPE = (1/n) × Σ|(真實值 - 預測值) / 真實值| × 100%
```

**🔍 實際意義**:
- 告訴你「平均錯了百分之多少」
- 可以跨不同規模數據比較
- MAPE = 10% → 平均錯 10%

**⚠️ 特殊情況**:
- MAPE = Infinity → 有真實值為 0 的情況
- MAPE > 100% → 預測非常不準確

---

### 6. R² (決定係數) - 最重要的綜合指標

**🎯 目的**: 衡量模型解釋了多少變異

**📐 公式**:
```
R² = 1 - [實際誤差] / [總變異]
   = 1 - [Σ(真實值 - 預測值)²] / [Σ(真實值 - 平均值)²]
```

**🔍 直觀理解**:
- 告訴你模型比「猜平均值」好多少
- 範圍從 -∞ 到 1
- 可理解為「解釋變異的百分比」

**📊 分數解讀**:
- **R² = 1.0**: 完美預測 🎯
- **R² = 0.9**: 解釋 90% 變異，非常好 ⭐⭐⭐⭐⭐
- **R² = 0.7**: 解釋 70% 變異，良好 ⭐⭐⭐⭐
- **R² = 0.5**: 解釋 50% 變異，一般 ⭐⭐⭐
- **R² = 0.0**: 等同於猜平均值 ⭐⭐
- **R² < 0**: 比猜平均值還差 ⭐

**💡 實際意義**:
R² = 0.8 表示：如果數據有 100 單位變異，模型解釋了 80 單位，剩下 20 單位是隨機因素。

---

## 📈 訓練圖表解讀

### 基本訓練曲線 (`training_curves.png`)

#### 訓練/驗證損失圖 (左上)
- **藍線**: 訓練損失
- **紅線**: 驗證損失
- **綠星**: 最佳 epoch

**✅ 正常情況**:
1. 藍線穩定下降
2. 紅線先下降後穩定
3. 驗證損失不應比訓練損失高太多

**🚨 警告信號**:
- 紅線上升而藍線下降 → **過擬合**
- 兩線都很高且不下降 → **欠擬合**
- 線條劇烈震盪 → **學習率太高**

#### MAE 演變圖 (右上)
- 數值越小越好
- 訓練/驗證差距不應太大
- 趨勢應與損失一致

#### 學習率調度圖 (左下)
- 通常是水平線（固定學習率）
- 有時呈階梯狀下降（學習率衰減）

### 指標演變圖 (`metric_evolution.png`)

**重點關注 R² 圖**:
```
✅ 理想情況:
訓練 R² = 0.9，驗證 R² = 0.8 → 很好！

⚠️ 需要注意:
訓練 R² = 0.9，驗證 R² = 0.3 → 過擬合

❌ 有問題:
訓練 R² = 0.3，驗證 R² = 0.2 → 欠擬合
```

### 進階分析圖 (`advanced_metrics.png`)

#### 收斂分析 (左下)
- **藍線**: 實際損失變化
- **紅虛線**: 趨勢線
- 趨勢線向下 → 模型在改善
- 趨勢線平穩 → 模型收斂

#### 過擬合分析 (右下)
- **粉色區域**: 過擬合程度
- 區域越小越好
- 區域擴大 → 過擬合加劇

---

## 🔍 實際診斷案例

### 案例：嚴重過擬合

**症狀**:
```
訓練 R² = 0.93    驗證 R² = -6
訓練 MAE = 0.3    驗證 MAE = 1.9
```

**診斷步驟**:

1. **看 R²**: 
   - 訓練 R² = 0.93 ✅ 模型學習能力強
   - 驗證 R² = -6 ❌ 比隨機猜測還差

2. **看 MAE**:
   - 訓練 MAE = 0.3 ✅ 相對較小
   - 驗證 MAE = 1.9 ❌ 是訓練的 6 倍多

3. **計算差距**:
   - R² 差距 = 0.93 - (-6) = 6.93 ❌ 差距巨大
   - MAE 比例 = 1.9 / 0.3 = 6.3 倍 ❌ 過度差距

**結論**: 🚨 嚴重過擬合！

**解決方案**:
1. **立即**: 增加 Dropout 到 0.4-0.5
2. **中期**: 減少模型複雜度
3. **長期**: 收集更多訓練數據

---

## 🎯 好模型的標準

### ✅ 理想指標表現
```
損失:       ↓ 穩定下降，最終穩定在低值
MAE/RMSE:   ↓ 數值合理，訓練/驗證接近
MAPE:       ↓ 低於 20%（依應用而定）
R²:         ↑ 訓練 > 0.8，驗證 > 0.6，差距 < 0.2
```

### 🚨 需要警惕的信號
```
過擬合:     訓練指標優秀，驗證指標很差
欠擬合:     所有指標都不好
不穩定:     指標劇烈震盪
數據問題:   異常值（如 MAPE = Infinity）
```

### 📈 改進策略

| 問題類型 | 症狀 | 解決方案 |
|----------|------|----------|
| **過擬合** | 訓練好，驗證差 | 正則化、早停、更多數據 |
| **欠擬合** | 所有指標都差 | 增加複雜度、減少正規化 |
| **不穩定** | 指標劇烈震盪 | 降低學習率、批次標準化 |
| **數據問題** | 異常值出現 | 檢查預處理、清理異常值 |

---

## 💡 實用檢查清單

### 每次訓練後必查
- [ ] 驗證損失是否合理下降？
- [ ] R² 是否為正值且合理？
- [ ] 訓練/驗證指標差距是否 < 3 倍？
- [ ] MAPE 是否 < 30%？
- [ ] 是否出現異常值（Infinity, NaN）？

### 過擬合快速檢測
```python
def check_overfitting(train_loss, val_loss, train_r2, val_r2):
    loss_ratio = val_loss / train_loss
    r2_gap = train_r2 - val_r2
    
    if loss_ratio > 5 or r2_gap > 0.3:
        return "🚨 嚴重過擬合"
    elif loss_ratio > 2 or r2_gap > 0.15:
        return "⚠️ 輕微過擬合"
    else:
        return "✅ 正常"
```

### 指標健康度評估
```python
def assess_model_health(metrics):
    val_r2 = metrics['val_r2']
    val_mae = metrics['val_mae']
    
    if val_r2 > 0.8:
        return "⭐⭐⭐⭐⭐ 優秀"
    elif val_r2 > 0.6:
        return "⭐⭐⭐⭐ 良好"
    elif val_r2 > 0.3:
        return "⭐⭐⭐ 一般"
    elif val_r2 > 0:
        return "⭐⭐ 需改進"
    else:
        return "⭐ 有問題"
```

---

理解這些指標是成功訓練模型的關鍵。記住：機器學習是迭代過程，通過不斷分析指標並調整策略，你的模型會越來越好！