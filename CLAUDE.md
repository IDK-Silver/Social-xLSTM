# CLAUDE.md

> å…¥å£æ–‡ä»¶ï¼›èšç„¦ Claude å°è©±æµç¨‹ã€å•Ÿå‹•æª¢æŸ¥èˆ‡å¸¸ç”¨æŒ‡ä»¤  
> ç›¡é‡æ§åˆ¶åœ¨ 120 è¡Œå…§ä»¥é™ä½æ‘˜è¦æè€—

---

## ğŸ§­ Claude å°è©±æµç¨‹

1. **ç†è§£**ï¼šå®Œæ•´ç†è§£ä¸­æ–‡éœ€æ±‚  
2. **æ€è€ƒ**ï¼šä»¥è‹±æ–‡é€²è¡ŒæŠ€è¡“æ¨ç†èˆ‡æ±ºç­–  
3. **å›è¦†**ï¼šä»¥ä¸­æ–‡å›è¦†ï¼Œä¿ç•™é—œéµè‹±æ–‡è¡“èªèˆ‡ç¨‹å¼ç¢¼  
4. **æª”æ¡ˆä¿®æ”¹**ï¼šç›´æ¥ç·¨è¼¯ç¾æœ‰æª”æ¡ˆï¼›ä½¿ç”¨åŸå§‹æª”åé€²è¡Œæ›´æ–°

---

## ğŸš€ å•Ÿå‹•æª¢æŸ¥ï¼ˆæ¯æ¬¡æ–°æœƒè©±ï¼‰

- `docs/_work/task.md` - **æ¶æ§‹é‡æ•´è¨ˆåŠƒèˆ‡é€²åº¦** â­  
- `todo.md` - å„ªå…ˆä»»å‹™  
- **é‡è¦**ï¼šäº†è§£ç•¶å‰ YAGNI é‡æ§‹éšæ®µèˆ‡å·²å®Œæˆ PR-1 ç‹€æ³

---

## âš¡ Quick Start

```bash
conda env create -f environment.yaml
conda activate social_xlstm
pip install -e .
snakemake --configfile cfgs/snakemake/dev.yaml --cores 4
```

---

## ğŸ“‚ æ ¸å¿ƒæª”æ¡ˆ

| ä½ç½® | è§’è‰² |
|------|------|
| `src/social_xlstm/models/xlstm.py` | xLSTM æ ¸å¿ƒå¯¦ç¾ |
| `src/social_xlstm/models/vd_xlstm_manager.py` | VD å¯¦ä¾‹ç®¡ç†å™¨ â­ |
| `src/social_xlstm/models/distributed_social_xlstm.py` | ä¸»è¦æ¨¡å‹æ•´åˆ |
| `src/social_xlstm/utils/tensor_checks.py` | å¼µé‡é©—è­‰å·¥å…· (æ–°) |

---

## ğŸ’» å¸¸ç”¨å·¥ä½œæµ

| ç›®æ¨™ | æŒ‡ä»¤ |
|------|------|
| å–®/å¤š VD è¨“ç·´ | `snakemake train_*_without_social_pooling --cores 4 --configfile cfgs/snakemake/dev.yaml` |
| æ¸¬è©¦ | `pytest -n auto` |

---

## ğŸ“‘ Immutable Assetsï¼ˆå”¯è®€è³‡æºï¼‰

| è³‡æº | æŒ‡å¼• |
|------|------|
| `blob/dataset/` | åƒ…ä¾›è®€å–ï¼Œä»»ä½•å¯«å…¥è«‹æ”¹ç”¨æš«å­˜è·¯å¾‘ |
| `environment.yaml` | ç”± Maintainer ç®¡ç†ï¼›å¦‚éœ€è®Šæ›´è«‹é–‹ Issue |
| æª”æ¡ˆçµæ§‹ | ä¿®æ”¹è«‹ç›´æ¥è¦†å¯«åŸæª”ï¼Œä¿æŒåŸå§‹æª”å |

---

## ğŸ“ æäº¤è¦ç¯„

| è®Šæ›´é¡å‹ | Commit æ¨™é ­ç¯„ä¾‹ |
|----------|------------------|
| çµæ§‹é‡æ§‹ | `Refactor: extract coordinate helper` |
| æ–°å¢åŠŸèƒ½ | `Add: implement Social Pooling aggregation` |
| ä¿®å¾©å•é¡Œ | `Fix: handle NaN in processor` |
| æ¸¬è©¦/æ–‡æª” | `Test: add unit tests` / `docs: add guide` |

---

## ğŸ§ª TDD Shortcut

**Red** â†’ **Green** â†’ **Refactor**ï¼šå¤±æ•—æ¸¬è©¦ â†’ æœ€å°‘å¯¦ä½œ â†’ é‡æ§‹å„ªåŒ–

---

## âš ï¸  é–‹ç™¼åŸå‰‡

**æ¥µç°¡å„ªå…ˆ**ï¼šæ–°åŠŸèƒ½å…ˆå¯¦ä½œæœ€åŸºæœ¬ç‰ˆæœ¬ï¼Œç„¡èŠ±è£¡èƒ¡å“¨åŠŸèƒ½
- ç„¡æ—©åœæ©Ÿåˆ¶ï¼šä¸è¦æ·»åŠ  EarlyStoppingã€è¤‡é›œ callbacks
- ç„¡è¤‡é›œç›£æ§ï¼šé¿å…éåº¦çš„ loggingã€metrics æ”¶é›†
- æ ¸å¿ƒåŠŸèƒ½å…ˆè¡Œï¼šåŸºæœ¬åŠŸèƒ½ç©©å®šå¾Œå†è€ƒæ…®é«˜ç´šåŠŸèƒ½
- YAML é©…å‹•ï¼šåƒæ•¸ç®¡ç†å„ªå…ˆä½¿ç”¨é…ç½®æ–‡ä»¶è€Œé CLI

**å¾ŒçºŒæ“´å±•**ï¼šç•¶åŸºæœ¬åŠŸèƒ½é©—è­‰ç„¡èª¤å¾Œï¼Œå†é€æ­¥æ·»åŠ é€²éšåŠŸèƒ½

## ğŸ§¹ æ¶æ§‹æ•´ç†ä¸­ï¼ˆ2025-08-26 é€²è¡Œä¸­ï¼‰

**åŸºæ–¼ YAGNI åŸå‰‡çš„éåº¦è¨­è¨ˆæ¸…ç†**ï¼š
- **å•é¡Œ**ï¼šå¤§é‡ LLM ç”Ÿæˆç¨‹å¼ç¢¼å°è‡´é‡è¤‡å¯¦ç¾å’Œä¸å¿…è¦æŠ½è±¡
- **ç›®æ¨™**ï¼š40-50% ç¨‹å¼ç¢¼æ¸›å°‘ï¼Œæ¶ˆé™¤æ¶æ§‹å‚µå‹™
- **é€²åº¦**ï¼šå·²å®Œæˆ PR-1 (TensorSpecç§»é™¤ï¼Œ~200è¡Œæ·¨æ¸›å°‘)

**é‡é»æ¸…ç†å€åŸŸ**ï¼š
- `src/social_xlstm/interfaces/` - å–®ä¸€å¯¦ç¾çš„æŠ½è±¡åŸºé¡
- `src/social_xlstm/dataset/storage/` - éåº¦è¨­è¨ˆçš„è³‡æ–™çµæ§‹
- é‡è¤‡é¡åˆ¥åç¨±è¡çª (å¦‚å…©å€‹ `VDXLSTMManager`)

**ä¿ç•™æ ¸å¿ƒæ¶æ§‹**ï¼š
- `VDXLSTMManager` - Social-xLSTM åˆ†æ•£å¼è™•ç†æ ¸å¿ƒçµ„ä»¶
- `TrafficXLSTM` - xLSTM å¯¦ç¾æœ¬é«”
- `DistributedSocialXLSTMModel` - ä¸»è¦æ¨¡å‹æ•´åˆ

**å¯¦æ–½è¨ˆåŠƒ**ï¼šè©³è¦‹ `docs/_work/task.md` çš„ 5 éšæ®µ PR è¨ˆåŠƒ

---

## ğŸ“ å¼µé‡ç¶­åº¦æ¨™æº–è¦ç¯„

**B T N F æ¨™æº–** (âš ï¸ å¿…é ˆéµå¾ª)ï¼š**B** (Batch) | **T** (Time Steps) | **N** (VDs æ•¸é‡) | **F** (ç‰¹å¾µç¶­åº¦)

**æ ¼å¼**: é›†ä¸­å¼ `Tensor[B, T, N, F]` | åˆ†æ•£å¼ `Dict[VD_ID, Tensor[B, T, F]]`

**è¨»é‡‹**: `# [B, T, N, F] - B=æ‰¹æ¬¡, T=æ™‚é–“æ­¥, N=VDæ•¸é‡, F=ç‰¹å¾µ`

---

## ğŸ“š æ–‡æª”çµæ§‹ï¼ˆ2025-08-06 é‡çµ„ï¼‰

**ä¸‰å±¤æ¶æ§‹**ï¼šç°¡åŒ–ç‚º 3 å€‹ä¸»ç›®éŒ„ï¼Œæå‡ LLM æª¢ç´¢æ•ˆç‡
- `docs/guides/` - ä½¿ç”¨æŒ‡å—ï¼ˆå¦‚ä½•åšï¼‰
- `docs/concepts/` - æ¦‚å¿µèªªæ˜ï¼ˆç‚ºä»€éº¼ï¼‰  
- `docs/reference/` - API åƒè€ƒï¼ˆæ˜¯ä»€éº¼ï¼‰

## ğŸ”— æ·±å…¥é–±è®€

`docs/guides/quickstart/` | `docs/concepts/architecture/`

## ğŸ”” è¨˜æ†¶å‚™å¿˜

- æ¯ç•¶å®Œæˆ todo.md çš„å…§å®¹è¦æ›´æ–°æ‰“å‹¾ç‹€æ…‹
- **é‡æ§‹ç‹€æ…‹**ï¼šPR-1 å®Œæˆï¼Œä¸‹æ­¥ PR-2 çµ±ä¸€ VDXLSTMManager
- **ç¦æ­¢éåº¦è¨­è¨ˆ**ï¼šç™¼ç¾å–®ä¸€å¯¦ç¾æŠ½è±¡ç«‹å³ç§»é™¤
- **TensorSpec å·²ç§»é™¤**ï¼šä½¿ç”¨ `utils.tensor_checks` ç°¡å–®å‡½æ•¸

## ğŸ¯ ç•¶å‰é‡æ§‹éšæ®µ

**å·²å®Œæˆ PR-1**ï¼šTensorSpec ç§»é™¤ (236â†’53è¡Œ)
**é€²è¡Œä¸­ PR-2**ï¼šVDXLSTMManager çµ±ä¸€ (ç§»é™¤ interfaces ç‰ˆæœ¬)
**å¾…è¾¦ PR-3-5**ï¼šTrafficFeature ç°¡åŒ–ã€interfaces æ¸…ç†ã€æœ€çµ‚æ•´ç†